generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model WppInstance {
    name         String
    phone        String
    instanceName String          @map("instance_name")
    type         WppInstanceType
    isActive     Boolean         @map("is_active")
    WABAPhoneId  String?         @map("WABA_phone_id")
    WABAToken    String?         @map("WABA_token")

    @@unique([instanceName, name])
    @@index([isActive])
    @@map("instances")
}

model WppContact {
    name         String
    phone        String
    customerId   Int     @map("customer_id")
    instanceName String  @map("instance_name")
    isBlocked    Boolean @map("is_blocked")
    onlyAdmin    Boolean @map("only_admin")

    @@unique([instanceName, phone])
    @@index([customerId, instanceName])
    @@map("contacts")
}

model WppMessage {
    id        String           @id
    from      String
    to        String
    type      String
    quotedId  String?          @map("quoted_id")
    chatId    Int?             @map("chat_id")
    body      String
    timestamp BigInt
    status    WppMessageStatus
    fileId    Int?             @map("file_id")
    fileName  String?          @map("file_name")
    fileType  String?          @map("file_type")
    fileSize  String?          @map("file_size")

    @@index([from, to, chatId])
    @@map("messages")
}

model WppChat {
    id           Int             @id @default(autoincrement())
    instanceName String          @map("instance_name")
    isFinished   Boolean         @map("is_finished")
    userId       Int             @map("user_id")
    botId        Int?            @map("bot_id")
    resultId     Int?            @map("result_id")
    type         WppChatType
    priority     WppChatPriority
    avatarUrl    String?         @map("avatar_url")

    @@index([userId])
    @@map("chats")
}

model WppSector {
    id            Int             @id @default(autoincrement())
    name          String
    instanceName  String          @map("instance_name")

    WppSectorUser WppSectorUser[]

    @@unique([instanceName, name])
    @@map("sectors")
}

model WppSectorUser {
    instanceName String 		@map("instance_name")
    userId       Int            @map("user_id")
    sectorId     Int            @map("sector_id")

    sector WppSector @relation(fields: [sectorId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    @@unique([instanceName, userId])
    @@map("sectors_users")
}

enum WppMessageStatus {
    PENDING
    SENT
    RECEIVED
    READ
    DOWNLOADED
    ERROR

    @@map("message_status")
}

enum WppInstanceType {
    WABA
    WWEBJS
}

enum WppChatType {
    RECEPTIVE
    ACTIVE

    @@map("chat_type")
}

enum WppChatPriority {
    LOW
    NORMAL
    HIGH
    VERY_HIGH
    URGENCY

    @@map("chat_priority")
}
